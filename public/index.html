<!-- index.html -->
<!doctype html>
<html lang="en-US">
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta charset="utf-8">
	<script src="/includes/jquery.min.js" type="text/javascript"></script>
	<script src="/includes/jquery-migrate.min.js" type="text/javascript"></script>
	<script src="/includes/angular.js"></script>
    <script src="/includes/angular-animate.js"></script>
    <script src="/includes/ui-bootstrap-tpls-1.3.2.min.js"></script>
    <script src="core.js"></script>
    <link href="/includes/bootstrap.min.css" rel="stylesheet">
    <link href="/includes/toggle-switch.css" rel="stylesheet">
	<script type="text/javascript" src="/includes/jwplayer/jwplayer.js"></script>
	<script type="text/javascript">jwplayer.key="+rrlB3wprn26V24N1tGu0ATArz7gd0p/Y/e7DJfsBSw=";</script>	
	
	<link rel="stylesheet" href="/includes/style.css" />
	
	<link rel="stylesheet" href="./TauSub_files/magnific-popup.css" type="text/css">
  	<link rel="stylesheet" href="./TauSub_files/template.css" type="text/css">
  	<link rel="stylesheet" href="./TauSub_files/template(1).css" type="text/css">
  	<link href="./TauSub_files/css" rel="stylesheet" type="text/css">
</head>

<body>
	<div ng-app="Tau-Subtitles" ng-controller="subtitleTableController">
	<div class="alerts-container">
	 	<uib-alert ng-repeat="alert in alerts" type="{{alert.type}}" close="closeAlert($index)" dismiss-on-timeout=5000>{{alert.msg}}</uib-alert>
    </div>

   	<div class="header container visible-desktop">
		<div class="row-fluid">
			<div class="span7">
				<div class="logo tau-logo pull-left">
					<a href="http://video.tau.ac.il/events">
						<img src="./TauSub_files/logo-tau.png" alt="Tel Aviv University">
					</a>
				</div>
				<div class="logo tau-webcast pull-left">
					<a href="http://video.tau.ac.il/events">
						<img src="./TauSub_files/logo-webcast.png" alt="TAU WEBCAST">
					</a>
				</div>
			</div>

			<div class="span5">
				<h1 class="pull-right">Digital Media Services | <a href="http://video.tau.ac.il/events">
					<strong>Events</strong>
				</a></h1>
			</div>
		</div>
	</div>

	<div class="navigation container" id="top">
		<div class="navbar">
			<div class="navbar-inner">

				 <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
				<a class="btn pull-right hidden-desktop" data-toggle="collapse" data-target=".nav-collapse">
				MENU <span class="icon-menu"></span>
				</a>

				<a class="brand hidden-desktop" href="http://video.tau.ac.il/events">
					<img src="./TauSub_files/icon-webcast.png" alt="TAU Webcast">
					<span>TAU <strong>Webcast</strong></span>
				</a>

				<div class="nav-collapse collapse">
					<div class="tau-links">
						<div class="pull-right youtube-link">
							<a href="https://www.youtube.com/user/TAUVOD" target="_blank"><span class="icon-play"></span> Youtube Channel</a>
						</div>
						<ul class="nav menu nav-pills pull-right">
							<li class="item-423"><a href="http://video.tau.ac.il/">Webcast Home</a></li>
							<li class="item-424"><a href="http://video.tau.ac.il/courses">Webcast: Courses</a></li>
							<li class="item-517"><a href="http://www.tau.ac.il/" target="_blank">Tel Aviv University</a></li>
						</ul>

						<ul class="nav menu">
							<li class="item-425"><a href="http://video.tau.ac.il/events/index.php?option=com_content&amp;view=featured&amp;Itemid=56">Events</a></li>
							<li class="item-514"><a href="http://video.tau.ac.il/events/index.php?option=com_content&amp;view=article&amp;id=46&amp;Itemid=514">Live Webcast</a></li>
							<li class="item-515"><a href="http://video.tau.ac.il/events/index.php?option=com_k2&amp;view=itemlist&amp;task=category&amp;id=132:tau-general">TAU General Events</a></li>
							<li class="item-516"><a href="http://video.tau.ac.il/events/index.php?option=com_k2&amp;view=itemlist&amp;task=category&amp;id=67:faculty-events">Faculty Events</a></li>
							<li class="item-431"><a href="http://www.youtube.com/TAUVOD" target="_blank">YouTube Channel</a></li>
						</ul>
					</div>


				</div>
			</div>
		</div> <!-- End Navbar -->
	</div>

	<!-- Body -->
	<div class="body">
		<div class="container main-container">
			<!-- Header -->

			<div class="row-fluid">
								<div id="content" class="span12">
					<!-- Begin Content -->
					<div class="content-inner">

						<div class="content-page">
							<div id="system-message-container">
	</div>


<div id="k2Container" class="default-template itemView" itemprop="video" itemscope="" itemtype="http://schema.org/VideoObject">








    <div class="itemVideoBlock">
					<span class="itemVideo">

<!-- JoomlaWorks "AllVideos" Plugin (v4.7.0) starts here -->



<!-- JoomlaWorks "AllVideos" Plugin (v4.7.0) ends here -->

</span>


					<span class="itemVideoCredits" itemprop="sourceOrganization">Tel-Aviv University</span>

	  <div class="clr"></div>
  </div>

  <script type="text/javascript" src="./TauSub_files/speed.js"></script>









    <!-- Related items by tag -->




</div></div></div></div></div></div></div>

    	<div class="container-fluid input-text-max-width" ng-hide="authenticated">
    		<h1>TAU Sub</h1>
    		<p>Please authenticate:</p>
    		<p>User Name:<input type="text" class="form-control padding-div" ng-model="userId"> </p>
    		<p>Password:<input type="password" class="form-control padding-div" ng-model="userPass"></p>
    		
    		<button class="btn btn-primary padding-div" ng-click="tryToAuthenticate()"> Login </button>
    	</div>

		<div class="container-fluid" ng-show="authenticated">
			<div class="alert alert-info" role="alert">
			    <p><b>Play\Stop</b> - 'ctrl + Enter', <b>Save</b> - 'ctrl + shift + S'
			    <b>Add Row</b> - 'ctrl + S' \ Enter , <b>Remove Row</b> - 'ctrl + D' 
			    <b>Set Start Time</b> - 'ctrl + G', <b>Set Finish Time</b> - 'ctrl + F'
			    <b>Faster</b> - 'ctrl + Arrow Up', <b>Slower</b> - 'ctrl + Arrow Down' 
			    <b>Loop</b> - 'ctrl + L'</p>
			</div>
	  		<div class="row">
				<div class="col-md-4">
		        </div>				
		        <div class="col-md-1">
		        	<label class="switch-light switch-candy" onclick="">
  						<input type="checkbox" id="loop">
						  <strong>
						    Loop
						  </strong>
						  <span>
						    <span>Off</span>
						    <span>On</span>
						    <a></a>
						  </span>
					</label>
	       		</div>
	       	</div>
			<div class="row">
			    <div class="col-md-4">
			        <div id="videoFrame" title="TAU Webcast video player">
			            <a href="rtsp://vod.tau.ac.il:80/Courses/_definst_/mp4:0111/1216/0111121601-20152-12179.mp4">
			                <img src='./Content/Img/filmPlaceHolder.jpg'>
			            </a>
			        </div>
			        <div class="padding-div">
			        	    <button class="btn btn-primary" ng-click="keyPressedFromTextBox(0,4)">
					            Save
					        </button>
			        </div>
			         <div class="padding-div" ng-show="latestHash.length > 0">
			         	Your Hash Is: {{latestHash}} - <a href="/api/getLatestSubtitles/{{latestHash}}">Download</a>
			         </div>
				</div>

				<div class="col-md-8" style="overflow-y: scroll; height:400px;">
					<table class="table">
					    <thead>
					      <tr>
					      	<th class="col-md-1">#</th>
					        <th class="col-md-1">Start Time</th>
					        <th class="col-md-1">End Time</th>
					        <th class="col-md-9">Text</th>
					      </tr>
					    </thead>
					    <tbody>
					      <tr ng-repeat="sub in subtitles track by $index" ng-class="validSubtitle(sub).length == 0 ? 'alert-success' : 'alert-danger'">
					      	<td>{{subtitles.length - $index}}</td>
					        <td ng-click="timeClick(sub.startTime)" onmouseover="" style="cursor: pointer;">{{ticksToTimeString(sub.startTime)}}</td>
					        <td>{{ticksToTimeString(sub.endTime)}}</td>
					        <td>
					        	<input type="text" class="form-control" maxlength="80" ng-model="sub.txt" ng-click="subClick($index)" my-enter="keyPressedFromTextBox($index" >
					        	{{validSubtitle(subtitles[$index])}}
					        </td>
					      </tr>
					    </tbody>
					  </table>
				</div>
			</div>
	  </div>
	</div>
</body>
</html>


<script type="text/javascript">
	var playerInstance = jwplayer("videoFrame");


	var getQueryVariable = function(variable) {
	    var query = window.location.search.substring(1);
	    var vars = query.split('&');
	    for (var i = 0; i < vars.length; i++) {
	        var pair = vars[i].split('=');
	        if (decodeURIComponent(pair[0]) == variable) {
	            return decodeURIComponent(pair[1]);
	        }
	    }
	}

	var videoId = getQueryVariable("id");
	var userId = getQueryVariable("user");
	
	// rtsp://vod.tau.ac.il:80/Courses/_definst_/mp4:1011/2106/1011210611-20152-12387.mp4
	// http://lool.tau.ac.il/index.html?user=yairlevi1&id=10112106112015212387

	// rtsp://vod.tau.ac.il:80/Courses/_definst_/mp4:1411/9108/1411910801-20152-12386.mp4
	// http://lool.tau.ac.il/index.html?user=yairlevi1&id=14119108012015212386

	var getVideoUrlFromParam = function(videoId){
		if (!videoId) {
			return "";
		}

		var baseUrl = "://vod.tau.ac.il:80/Courses/_definst_/mp4:";
		var part1 = videoId.substring(0,4);
		var part2 = videoId.substring(4,8);
		var part3 = videoId.substring(8,10);
		var part4 = videoId.substring(10,15);
		var part5 = videoId.substring(15,20);

		return baseUrl + part1 + "/" + part2 + "/" + part1 + part2 + part3 + "-" + part4 + "-" + part5 + ".mp4/";
	}

	var videoUrl = getVideoUrlFromParam(videoId);

	var rtmpUrl = "rtmp" + videoUrl + "playlist.m3u8";
	var httpUrl1 = "http" + videoUrl + "manifest.mpd";
	var httpUrl2 = "http" + videoUrl + "playlist.m3u8";
	var chaptersStr = '/Chapters/' + videoId + '/latestChapter.srt';

	if (navigator.userAgent.match(/android/i) != null){
	    playerInstance.setup({
	    	playlist: [{
	        file: rtmpUrl,
	        image: '/Content/Img/filmPlaceHolder.jpg',
            tracks: [{
			    file: chaptersStr,
			    kind:'chapters'
			  }],
	        type: 'mp4',
	        primary: 'html5'
	    	}]
	    });
	} else {
	    playerInstance.setup({
	    	playlist: [{
	        file: httpUrl1,
	        image: '/Content/Img/filmPlaceHolder.jpg',
            tracks: [{
			    file: chaptersStr,
			    kind:'chapters'
			  }],
	        autostart: 'false'
	    	}]
	    });
	    
	    jQuery('.reloadMovie').on('click', function(){
	        playerInstance.remove();
	        playerInstance.setup({
	        	playlist: [{
	            file: httpUrl2,
	            image: '/Content/Img/filmPlaceHolder.jpg',
	            tracks: [{
				    file: chaptersStr,
				    kind:'chapters'
				  }],
	            primary: 'html5',
	            autostart: 'false',
	            controls: '1'
	        	}]
	        });
	    })

	    var trident = !!navigator.userAgent.match(/Trident\/7.0/);
	    var net = !!navigator.userAgent.match(/.NET4.0E/);
	    var IE11 = trident && net;
	    var IEold = ( navigator.userAgent.match(/MSIE/i) ? true : false );
	    var theVideo;
	    jwplayer().on('ready', function(){
	        theVideo = document.querySelector('video');
	        theVideo.defaultPlaybackRate = 1.0;
	        theVideo.playbackRate = 1.0;
	        if (jwplayer().getRenderingMode() == "flash"){
	            return;
	        }
	    });
	}

</script>