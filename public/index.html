<!-- index.html -->
<!doctype html>
<html lang="en-US">
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta charset="utf-8">
	<script src="/includes/jquery.min.js" type="text/javascript"></script>
	<script src="/includes/jquery-migrate.min.js" type="text/javascript"></script>
	<script src="/includes/angular.js"></script>
    <script src="/includes/angular-animate.js"></script>
    <script src="/includes/ui-bootstrap-tpls-1.3.2.min.js"></script>
    <script src="core.js"></script>
    <link href="/includes/bootstrap.min.css" rel="stylesheet">
	<script type="text/javascript" src="/includes/jwplayer/jwplayer.js"></script>
	<script type="text/javascript">jwplayer.key="+rrlB3wprn26V24N1tGu0ATArz7gd0p/Y/e7DJfsBSw=";</script>	
	
	<link rel="stylesheet" href="/includes/style.css" />
</head>

<body>
	<div ng-app="Tau-Subtitles" ng-controller="subtitleTableController">
	<div class="alerts-container">
	 	<uib-alert ng-repeat="alert in alerts" type="{{alert.type}}" close="closeAlert($index)" dismiss-on-timeout=2000>{{alert.msg}}</uib-alert>
    </div>
		<div class="container-fluid" ng-show="subtitles.length > 0">
			  <div class="jumbotron">
			    <h1>TAU Sub</h1>
			    <p>Add Row - 'ctrl + s' , Play\Stop - 'ctrl + enter' , Set Finish Time - 'ctrl + f' , Set Start Time - 'ctrl + g' , Remove Row - 'ctrl + d' , Save Subtitles = 'ctrl + shift + s</p>
			  </div>

			<div class="row">
			    <div class="col-md-4">
			        <div id="videoFrame" title="TAU Webcast video player">
			            <a href="rtsp://vod.tau.ac.il:80/Courses/_definst_/mp4:0111/1216/0111121601-20152-12179.mp4">
			                <img src='./Content/Img/filmPlaceHolder.jpg'>
			            </a>
			        </div>
			        <div class="padding-div">
			        	    <button class="btn btn-primary" ng-click="keyPressedFromTextBox(0,4)">
					            Save
					        </button>
			        </div>
			         <div class="padding-div" ng-show="latestHash.length > 0">
			         	Your Hash Is: {{latestHash}} - <a href="/api/getLatestSubtitles/{{latestHash}}">Download</a>
			         </div>
				</div>

				<div class="col-md-8" style="overflow-y: scroll; height:400px;">
					<table class="table">
					    <thead>
					      <tr>
					        <th class="col-md-1">Start Time</th>
					        <th class="col-md-1">End Time</th>
					        <th class="col-md-10">Text</th>
					      </tr>
					    </thead>
					    <tbody>
					      <tr class="success" ng-repeat="sub in subtitles track by $index">
					        <td>{{ticksToTimeString(sub.startTime)}}</td>
					        <td>{{ticksToTimeString(sub.endTime)}}</td>
					        <td><input type="text" class="form-control" ng-model="sub.txt" my-enter="keyPressedFromTextBox($index" ></td>
					      </tr>
					    </tbody>
					  </table>
				</div>
			</div>
	  </div>
	</div>
</body>
</html>


<script type="text/javascript">
	var playerInstance = jwplayer("videoFrame");
	if (navigator.userAgent.match(/android/i) != null){
	    playerInstance.setup({
	    	playlist: [{
	        file: 'rtmp://vod.tau.ac.il:80/Courses/_definst_/mp4:0111/1216/0111121601-20152-12179.mp4/playlist.m3u8',
	        image: '/Content/Img/filmPlaceHolder.jpg',
	        type: 'mp4',
	        primary: 'html5',
	        tracks: [{ 
            file: "/videos/Martin.vtt", 
            label: "English",
            kind: "captions",
            "default": true 
        },{ 
            file: "/videos/Martin.vtt", 
            kind: "captions",
            label: "French"
        }]}]
	    });
	} else {
	    playerInstance.setup({
	    	playlist: [{
	        file: 'http://vod.tau.ac.il:80/Courses/_definst_/mp4:0111/1216/0111121601-20152-12179.mp4/manifest.mpd',
	        image: '/Content/Img/filmPlaceHolder.jpg',
	        autostart: 'false',
	        tracks: [{ 
            file: "/videos/Martin.vtt", 
            label: "English",
            kind: "captions",
            "default": true 
        },{ 
            file: "/videos/Martin.vtt", 
            kind: "captions",
            label: "French"
        }]}]
	    });
	    
	    jQuery('.reloadMovie').on('click', function(){
	        playerInstance.remove();
	        playerInstance.setup({
	        	playlist: [{
	            file: 'http://vod.tau.ac.il:80/Courses/_definst_/mp4:0111/1216/0111121601-20152-12179.mp4/playlist.m3u8',
	            image: '/Content/Img/filmPlaceHolder.jpg',
	            primary: 'html5',
	            autostart: 'false',
	            controls: '1',
	            tracks: [{ 
            file: "/videos/Martin.vtt", 
            label: "English",
            kind: "captions",
            "default": true
        },{ 
            file: "/videos/Martin.vtt", 
            kind: "captions",
            label: "French"
        }]}]
	        });
	    })

	    var trident = !!navigator.userAgent.match(/Trident\/7.0/);
	    var net = !!navigator.userAgent.match(/.NET4.0E/);
	    var IE11 = trident && net
	    var IEold = ( navigator.userAgent.match(/MSIE/i) ? true : false );
	    var theVideo;
	    jwplayer().on('ready', function(){
	        theVideo = document.querySelector('video');
	        theVideo.defaultPlaybackRate = 1.0;
	        theVideo.playbackRate = 1.0;
	        if (jwplayer().getRenderingMode() == "flash"){
	            return;
	        }
	    });
	}

</script>